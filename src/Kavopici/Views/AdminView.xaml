<UserControl x:Class="Kavopici.Views.AdminView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:Kavopici.Converters"
             Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:NotNullToVisibilityConverter x:Key="NotNullToVis" />
        <converters:RoastLevelToStringConverter x:Key="RoastLevelConverter" />
        <converters:TabIndexConverter x:Key="TabIndexConv" />
        <converters:TabIndexToVisibilityConverter x:Key="TabIndexToVis" />
        <converters:DateOnlyToStringConverter x:Key="DateConverter" />
    </UserControl.Resources>

    <DockPanel>
        <!-- Header -->
        <Border DockPanel.Dock="Top" Style="{StaticResource HeaderPanel}">
            <Grid>
                <TextBlock Text="SPRÁVA" Style="{StaticResource TitleStyle}"
                           VerticalAlignment="Center" />
                <Button Content="← ZPĚT" Command="{Binding GoBackCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Foreground="White" BorderBrush="White"
                        HorizontalAlignment="Right" VerticalAlignment="Center" />
            </Grid>
        </Border>

        <!-- Tab buttons -->
        <Border DockPanel.Dock="Top" Background="{StaticResource CreamBrush}"
                BorderBrush="{StaticResource SilverBrush}" BorderThickness="0,0,0,1"
                Padding="20,8">
            <StackPanel Orientation="Horizontal">
                <RadioButton Content="UŽIVATELÉ" GroupName="AdminTabs"
                             IsChecked="{Binding SelectedTabIndex, Converter={StaticResource TabIndexConv}, ConverterParameter=0}"
                             Style="{StaticResource TabRadioButton}" />
                <RadioButton Content="SMĚSI" GroupName="AdminTabs"
                             IsChecked="{Binding SelectedTabIndex, Converter={StaticResource TabIndexConv}, ConverterParameter=1}"
                             Style="{StaticResource TabRadioButton}" Margin="8,0,0,0" />
                <RadioButton Content="KÁVA DNE" GroupName="AdminTabs"
                             IsChecked="{Binding SelectedTabIndex, Converter={StaticResource TabIndexConv}, ConverterParameter=2}"
                             Style="{StaticResource TabRadioButton}" Margin="8,0,0,0" />
            </StackPanel>
        </Border>

        <!-- Status/Error messages -->
        <StackPanel DockPanel.Dock="Bottom" Margin="20,8">
            <TextBlock Text="{Binding StatusMessage}" Style="{StaticResource StatusStyle}"
                       Visibility="{Binding StatusMessage, Converter={StaticResource NotNullToVis}}" />
            <TextBlock Text="{Binding ErrorMessage}" Style="{StaticResource ErrorStyle}"
                       TextWrapping="Wrap"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource NotNullToVis}}" />
        </StackPanel>

        <!-- Tab content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <Grid Margin="20">
                <!-- Users Tab -->
                <StackPanel Visibility="{Binding SelectedTabIndex, Converter={StaticResource TabIndexToVis}, ConverterParameter=0}">

                    <!-- Add user form -->
                    <Border Style="{StaticResource PanelBorder}" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="NOVÝ UŽIVATEL" Style="{StaticResource LabelStyle}" Margin="0,0,0,8" />
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding NewUserName, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource CoffeeTextBox}" Margin="0,0,8,0" />
                                <Button Grid.Column="1" Content="PŘIDAT" Command="{Binding AddUserCommand}"
                                        Style="{StaticResource AccentButton}" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Users list -->
                    <DataGrid ItemsSource="{Binding AllUsers}" Style="{StaticResource CoffeeDataGrid}"
                              ColumnHeaderStyle="{StaticResource CoffeeColumnHeader}"
                              RowStyle="{StaticResource CoffeeDataGridRow}"
                              CellStyle="{StaticResource CoffeeDataGridCell}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="JMÉNO" Binding="{Binding Name}" Width="*" />
                            <DataGridTemplateColumn Header="ADMIN" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsAdmin, Mode=OneWay}"
                                                  Command="{Binding DataContext.ToggleAdminCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                  CommandParameter="{Binding}"
                                                  HorizontalAlignment="Center" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="AKCE" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Deaktivovat"
                                                Command="{Binding DataContext.DeactivateUserCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource DangerButton}"
                                                Padding="8,4" FontSize="11" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Blends Tab -->
                <StackPanel Visibility="{Binding SelectedTabIndex, Converter={StaticResource TabIndexToVis}, ConverterParameter=1}">

                    <!-- Add blend form -->
                    <Border Style="{StaticResource PanelBorder}" Margin="0,0,0,20">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="NÁZEV SMĚSI" Style="{StaticResource LabelStyle}" Margin="0,0,0,4" />
                                <TextBox Text="{Binding NewBlendName, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource CoffeeTextBox}" />
                            </StackPanel>

                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,0,8">
                                <TextBlock Text="PRAŽÍRNA" Style="{StaticResource LabelStyle}" Margin="0,0,0,4" />
                                <TextBox Text="{Binding NewBlendRoaster, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource CoffeeTextBox}" />
                            </StackPanel>

                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="PŮVOD (NEPOVINNÝ)" Style="{StaticResource LabelStyle}" Margin="0,0,0,4" />
                                <TextBox Text="{Binding NewBlendOrigin, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource CoffeeTextBox}" />
                            </StackPanel>

                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,0,8">
                                <TextBlock Text="STUPEŇ PRAŽENÍ" Style="{StaticResource LabelStyle}" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding RoastLevels}"
                                          SelectedItem="{Binding NewBlendRoastLevel}"
                                          Style="{StaticResource CoffeeComboBox}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource RoastLevelConverter}}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="DODAVATEL" Style="{StaticResource LabelStyle}" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding AllUsers}"
                                          SelectedItem="{Binding NewBlendSupplier}"
                                          DisplayMemberPath="Name"
                                          Style="{StaticResource CoffeeComboBox}" />
                            </StackPanel>

                            <Button Grid.Row="3" Grid.Column="1"
                                    Content="PŘIDAT SMĚS"
                                    Command="{Binding AddBlendCommand}"
                                    Style="{StaticResource AccentButton}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Bottom" />
                        </Grid>
                    </Border>

                    <!-- Blends list -->
                    <DataGrid ItemsSource="{Binding AllBlends}" Style="{StaticResource CoffeeDataGrid}"
                              ColumnHeaderStyle="{StaticResource CoffeeColumnHeader}"
                              RowStyle="{StaticResource CoffeeDataGridRow}"
                              CellStyle="{StaticResource CoffeeDataGridCell}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="NÁZEV" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="PRAŽÍRNA" Binding="{Binding Roaster}" Width="*" />
                            <DataGridTextColumn Header="PŮVOD" Binding="{Binding Origin}" Width="100" />
                            <DataGridTextColumn Header="PRAŽENÍ" Binding="{Binding RoastLevel, Converter={StaticResource RoastLevelConverter}}" Width="100" />
                            <DataGridTextColumn Header="DODAVATEL" Binding="{Binding Supplier.Name}" Width="120" />
                            <DataGridTemplateColumn Header="AKCE" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Odstranit"
                                                Command="{Binding DataContext.DeactivateBlendCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource DangerButton}"
                                                Padding="8,4" FontSize="11" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Blend of the Day Tab -->
                <StackPanel Visibility="{Binding SelectedTabIndex, Converter={StaticResource TabIndexToVis}, ConverterParameter=2}">

                    <Border Style="{StaticResource PanelBorder}" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="NASTAVIT KÁVU DNE" Style="{StaticResource LabelStyle}" Margin="0,0,0,12" />

                            <!-- Current session info -->
                            <Border Style="{StaticResource AccentLeftBorder}" Margin="0,0,0,16"
                                    Visibility="{Binding CurrentSession, Converter={StaticResource NotNullToVis}}">
                                <StackPanel>
                                    <TextBlock Text="AKTUÁLNÍ VÝBĚR" Style="{StaticResource LabelStyle}" Margin="0,0,0,4" />
                                    <TextBlock Text="{Binding CurrentSession.Blend.Name}"
                                               Style="{StaticResource DisplayStyle}" />
                                    <TextBlock Text="{Binding CurrentSession.Comment}"
                                               Style="{StaticResource BodyStyle}"
                                               TextWrapping="Wrap"
                                               Margin="0,4,0,0"
                                               Visibility="{Binding CurrentSession.Comment, Converter={StaticResource NotNullToVis}}" />
                                </StackPanel>
                            </Border>

                            <!-- Blend picker -->
                            <TextBlock Text="VYBERTE SMĚS" Style="{StaticResource LabelStyle}" Margin="0,0,0,8" />
                            <ComboBox ItemsSource="{Binding AvailableBlends}"
                                      SelectedItem="{Binding SelectedBlendOfDay}"
                                      DisplayMemberPath="Name"
                                      Style="{StaticResource CoffeeComboBox}"
                                      Margin="0,0,0,12" />

                            <!-- Comment -->
                            <TextBlock Text="KOMENTÁŘ (NEPOVINNÝ)" Style="{StaticResource LabelStyle}" Margin="0,0,0,8" />
                            <TextBox Text="{Binding SessionComment, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource CoffeeTextBox}"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     MinHeight="48"
                                     MaxHeight="100"
                                     Margin="0,0,0,12" />

                            <StackPanel Orientation="Horizontal">
                                <Button Content="NASTAVIT JAKO DNEŠNÍ KÁVU"
                                        Command="{Binding SetBlendOfDayCommand}"
                                        Style="{StaticResource AccentButton}" />
                                <Button Content="EXPORTOVAT CSV"
                                        Command="{Binding ExportCsvCommand}"
                                        Style="{StaticResource PrimaryButton}"
                                        Margin="12,0,0,0" />
                                <Button Content="TISK PŘEHLEDU"
                                        Command="{Binding PrintReportCommand}"
                                        Style="{StaticResource PrimaryButton}"
                                        Margin="12,0,0,0" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Session history -->
                    <Border Style="{StaticResource PanelBorder}">
                        <StackPanel>
                            <TextBlock Text="HISTORIE OCHUTNÁVEK" Style="{StaticResource LabelStyle}" Margin="0,0,0,12" />
                            <DataGrid ItemsSource="{Binding SessionHistory}" Style="{StaticResource CoffeeDataGrid}"
                                      ColumnHeaderStyle="{StaticResource CoffeeColumnHeader}"
                                      RowStyle="{StaticResource CoffeeDataGridRow}"
                                      CellStyle="{StaticResource CoffeeDataGridCell}"
                                      MaxHeight="300">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="DATUM" Binding="{Binding Date, Converter={StaticResource DateConverter}}" Width="100" />
                                    <DataGridTextColumn Header="SMĚS" Binding="{Binding Blend.Name}" Width="*" />
                                    <DataGridTextColumn Header="PRAŽÍRNA" Binding="{Binding Blend.Roaster}" Width="120" />
                                    <DataGridTextColumn Header="DODAVATEL" Binding="{Binding Blend.Supplier.Name}" Width="120" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </DockPanel>
</UserControl>
