<UserControl x:Class="Kavopici.Views.LoginView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:Kavopici.Converters"
             Loaded="OnLoaded">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis" />
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVis" />
        <converters:NotNullToVisibilityConverter x:Key="NotNullToVis" />
    </UserControl.Resources>

    <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
        <Border Style="{StaticResource CardBorder}" MinWidth="400" MaxWidth="500" Padding="32">
            <StackPanel>
                <!-- App icon and title -->
                <Image Source="/Kavopici.ico"
                       Width="64" Height="64"
                       HorizontalAlignment="Center"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       Margin="0,0,0,12" />

                <TextBlock Text="KÁVOPÍČI"
                           Style="{StaticResource TitleStyle}"
                           Foreground="{StaticResource CoffeeDarkBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,8" />

                <TextBlock Text="Sdílená aplikace pro hodnocení kávy"
                           Style="{StaticResource BodyStyle}"
                           Foreground="{StaticResource CoffeeBrownBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,24" />

                <Separator Style="{StaticResource SeparatorLine}" Margin="0,0,0,24" />

                <!-- No database selected: create or open -->
                <StackPanel Visibility="{Binding IsDatabaseNotSelected, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="VYBERTE DATABÁZI" Style="{StaticResource LabelStyle}"
                               Margin="0,0,0,12" />

                    <TextBlock Text="Vytvořte novou databázi nebo otevřete existující:"
                               Style="{StaticResource BodyStyle}"
                               Margin="0,0,0,16" />

                    <Button Content="VYTVOŘIT NOVOU DATABÁZI"
                            Command="{Binding CreateNewDatabaseCommand}"
                            Style="{StaticResource AccentButton}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,8" />

                    <Button Content="OTEVŘÍT EXISTUJÍCÍ DATABÁZI"
                            Command="{Binding OpenExistingDatabaseCommand}"
                            Style="{StaticResource PrimaryButton}"
                            HorizontalAlignment="Stretch" />
                </StackPanel>

                <!-- First run: create admin -->
                <StackPanel Visibility="{Binding ShowFirstRun, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="PRVNÍ SPUŠTĚNÍ" Style="{StaticResource LabelStyle}"
                               Margin="0,0,0,12" />

                    <TextBlock Text="Vytvořte prvního administrátora:"
                               Style="{StaticResource BodyStyle}"
                               Margin="0,0,0,8" />

                    <TextBox Text="{Binding NewAdminName, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource CoffeeTextBox}"
                             Margin="0,0,0,12" />

                    <Button Content="VYTVOŘIT ADMINISTRÁTORA"
                            Command="{Binding CreateFirstAdminCommand}"
                            Style="{StaticResource AccentButton}"
                            HorizontalAlignment="Stretch" />
                </StackPanel>

                <!-- Normal login: select user -->
                <StackPanel Visibility="{Binding ShowNormalLogin, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="VYBERTE SVŮJ PROFIL" Style="{StaticResource LabelStyle}"
                               Margin="0,0,0,12" />

                    <ListBox ItemsSource="{Binding Users}"
                             SelectedItem="{Binding SelectedUser}"
                             Margin="0,0,0,16"
                             MaxHeight="300"
                             BorderBrush="{StaticResource SilverBrush}"
                             BorderThickness="1"
                             Background="White">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}"
                                           Style="{StaticResource BodyStyle}"
                                           Padding="8,6"
                                           FontSize="14" />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <Button Content="PŘIHLÁSIT SE"
                            Command="{Binding LoginCommand}"
                            Style="{StaticResource AccentButton}"
                            HorizontalAlignment="Stretch" />
                </StackPanel>

                <!-- Error message -->
                <TextBlock Text="{Binding ErrorMessage}"
                           Style="{StaticResource ErrorStyle}"
                           Margin="0,12,0,0"
                           TextWrapping="Wrap"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource NotNullToVis}}" />

                <!-- Database info footer (shown when a database IS selected) -->
                <StackPanel Visibility="{Binding IsDatabaseNotSelected, Converter={StaticResource InverseBoolToVis}}"
                            Margin="0,16,0,0">
                    <Separator Style="{StaticResource SeparatorLine}" Margin="0,0,0,8" />
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="{Binding SelectedDatabasePath}"
                                   Style="{StaticResource StatusStyle}"
                                   HorizontalAlignment="Center"
                                   MaxWidth="350"
                                   TextTrimming="CharacterEllipsis"
                                   ToolTip="{Binding SelectedDatabasePath}"
                                   Margin="0,0,0,4" />
                        <Button Content="Zavřít databázi"
                                Command="{Binding CloseDatabaseCommand}"
                                Style="{StaticResource LinkButton}"
                                HorizontalAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
